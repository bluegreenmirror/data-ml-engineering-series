%% sklearn_pipeline_flowchart_fixed.mmd
%% Vertical stack of Numeric + Categorical branches inside ColumnTransformer.
%% Render: mmdc -i sklearn_pipeline_flowchart_fixed.mmd -o pipeline.svg -b transparent -t neutral

%%{init:{
  "theme":"neutral",
  "securityLevel":"loose",
  "flowchart":{"useMaxWidth":true,"nodeSpacing":26,"rankSpacing":44,"curve":"linear"},
  "themeVariables":{
    "fontSize":"18px",
    "primaryColor":"#ffffff",
    "primaryTextColor":"#0b3d24",
    "primaryBorderColor":"#0c5c2c",
    "lineColor":"#285c91",
    "clusterBkg":"#f5f7f2",
    "clusterBorder":"#0c5c2c",
    "fontFamily":"-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif"
  }
}}%%
flowchart TB
  classDef step fill:#ffffff,stroke:#0c5c2c,stroke-width:1px,rx:8,ry:8,color:#0b3d24;
  classDef gate fill:#ffffff,stroke:#285c91,stroke-width:1.5px,rx:6,ry:6,color:#0b3d24;
  classDef ghost fill:transparent,stroke:transparent,color:transparent;

  A["Raw Data (pandas DF)"]:::step --> CT_ANCHOR:::ghost

  %% ColumnTransformer container with vertical stacking
  subgraph CT["ColumnTransformer"]
    direction TB

    %% Non-empty hidden anchor node to wire edges
    CT_ANCHOR["anchor"]:::ghost

    subgraph B1["Numeric branch"]
      direction TB
      Bn1["Impute: median"]:::step --> Bn2["Scale: StandardScaler"]:::step
    end

    subgraph B2["Categorical branch"]
      direction TB
      Bc1["OneHotEncoder: ignore unknowns"]:::step
    end
  end

  CT_ANCHOR:::ghost --> C["Estimator: LogisticRegression"]:::step
  C --> D{"Calibrate?"}:::gate
  D -- "yes" --> E["CalibratedClassifierCV"]:::step
  D -- "no"  --> C
  E --> F["Persist: model.joblib"]:::step
  F --> G["CLI: score.py"]:::step
  G --> H["Metrics & Plots"]:::step

  linkStyle default stroke:#285c91,stroke-width:1.5px,opacity:0.9;
